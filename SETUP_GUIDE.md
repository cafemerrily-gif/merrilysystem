# 📚 学生経営カフェ管理システム - 詳細セットアップガイド

このガイドでは、プログラミング初心者でも確実にシステムを動かせるよう、手順を1つずつ丁寧に説明します。

## 📋 目次

1. [必要なもの](#1-必要なもの)
2. [Supabaseアカウント作成](#2-supabaseアカウント作成)
3. [プロジェクトのダウンロードと展開](#3-プロジェクトのダウンロードと展開)
4. [Node.jsのインストール確認](#4-nodejsのインストール確認)
5. [必要なパッケージのインストール](#5-必要なパッケージのインストール)
6. [Supabaseプロジェクトの作成](#6-supabaseプロジェクトの作成)
7. [データベーステーブルの作成](#7-データベーステーブルの作成)
8. [環境変数の設定](#8-環境変数の設定)
9. [アプリケーションの起動](#9-アプリケーションの起動)
10. [動作確認](#10-動作確認)
11. [トラブルシューティング](#11-トラブルシューティング)

---

## 1. 必要なもの

セットアップを始める前に、以下を準備してください：

- ✅ **パソコン**（Windows、Mac、Linuxどれでも可）
- ✅ **インターネット接続**
- ✅ **メールアドレス**（Supabaseアカウント作成用）
- ✅ **Node.js**（バージョン 18.17 以上）
- ✅ **テキストエディタ**（VS Code推奨）

---

## 2. Supabaseアカウント作成

### ステップ 2-1: Supabaseにアクセス

1. ブラウザで [https://supabase.com](https://supabase.com) を開きます
2. 右上の「**Start your project**」または「**Sign Up**」ボタンをクリック

### ステップ 2-2: アカウント登録

以下のいずれかの方法でサインアップできます：

- **GitHubアカウントで登録**（推奨）
  - 「Continue with GitHub」をクリック
  - GitHubでログイン→認証
  
- **メールアドレスで登録**
  - メールアドレスとパスワードを入力
  - 届いた確認メールのリンクをクリック

### ステップ 2-3: ログイン確認

登録完了後、Supabaseのダッシュボードが表示されればOKです。

---

## 3. プロジェクトのダウンロードと展開

### ステップ 3-1: ZIPファイルのダウンロード

提供された `student-cafe-app-supabase.zip` をダウンロードします。

### ステップ 3-2: ZIPファイルの展開

**Windowsの場合：**
1. ZIPファイルを右クリック
2. 「すべて展開」をクリック
3. 展開先を選択（例：`C:\Users\あなたの名前\Desktop\`）
4. 「展開」をクリック

**Macの場合：**
1. ZIPファイルをダブルクリック
2. 自動的に展開されます

**展開後の確認：**
`student-cafe-app` というフォルダができていればOKです。

---

## 4. Node.jsのインストール確認

### ステップ 4-1: Node.jsがインストール済みか確認

**Windowsの場合：**
1. スタートメニューで「cmd」と検索
2. 「コマンドプロンプト」を起動
3. 以下のコマンドを入力してEnter：
   ```bash
   node --version
   ```

**Macの場合：**
1. Spotlight検索（⌘ + Space）で「terminal」と入力
2. 「ターミナル」を起動
3. 以下のコマンドを入力してEnter：
   ```bash
   node --version
   ```

**結果の確認：**
- `v18.17.0` のようなバージョン番号が表示される → ✅ インストール済み（次のステップへ）
- エラーメッセージが表示される → ⚠️ インストールが必要

### ステップ 4-2: Node.jsのインストール（必要な場合のみ）

1. [https://nodejs.org/](https://nodejs.org/) にアクセス
2. 「LTS（推奨版）」をダウンロード
3. ダウンロードしたファイルを実行
4. インストーラーの指示に従ってインストール
5. インストール完了後、ステップ4-1を再度実行して確認

---

## 5. 必要なパッケージのインストール

### ステップ 5-1: プロジェクトフォルダを開く

**Windowsの場合：**
1. コマンドプロンプトを開く
2. 以下のコマンドを入力（パスは自分の環境に合わせて変更）：
   ```bash
   cd C:\Users\あなたの名前\Desktop\student-cafe-app
   ```

**Macの場合：**
1. ターミナルを開く
2. 以下のコマンドを入力：
   ```bash
   cd ~/Desktop/student-cafe-app
   ```

**確認方法：**
```bash
dir    # Windows
ls     # Mac/Linux
```
`package.json` ファイルが表示されればOKです。

### ステップ 5-2: パッケージをインストール

以下のコマンドを実行します：
```bash
npm install
```

**⏰ 時間がかかります（2〜5分程度）**

インストール中、たくさんの文字が流れますが問題ありません。

**完了の確認：**
- エラーメッセージがなく、プロンプトが戻ってくればOK
- `node_modules` フォルダが作成されていることを確認

---

## 6. Supabaseプロジェクトの作成

### ステップ 6-1: 新規プロジェクトの作成

1. [https://supabase.com/dashboard](https://supabase.com/dashboard) にアクセス
2. 「**New Project**」ボタンをクリック

### ステップ 6-2: プロジェクト情報の入力

以下の情報を入力します：

- **Name**（プロジェクト名）: `student-cafe-app`（任意の名前でOK）
- **Database Password**（データベースパスワード）: 
  - 強力なパスワードを設定（最低12文字推奨）
  - 🔴 **重要：このパスワードは後で使わないので忘れてもOK**
- **Region**（リージョン）: 
  - `Northeast Asia (Tokyo)` を選択（日本から一番近い）
- **Pricing Plan**: `Free` を選択

### ステップ 6-3: プロジェクト作成の完了を待つ

「Create new project」をクリック後、1〜2分待ちます。

**完了の確認：**
プロジェクトのダッシュボードが表示されればOKです。

---

## 7. データベーステーブルの作成

### ステップ 7-1: SQL Editorを開く

1. Supabaseダッシュボードの左メニューから「**SQL Editor**」をクリック
2. 「**+ New query**」ボタンをクリック

### ステップ 7-2: SQLスクリプトをコピー

1. ダウンロードしたプロジェクトフォルダ内の `supabase-schema.sql` ファイルを開く
2. **ファイルの内容をすべてコピー**（Ctrl+A → Ctrl+C / ⌘+A → ⌘+C）

### ステップ 7-3: SQLを実行

1. SQL Editorの入力欄に、コピーした内容を**貼り付け**（Ctrl+V / ⌘+V）
2. 右下の「**Run**」ボタンをクリック

**実行結果の確認：**
- 画面下部に「Success. No rows returned」と表示されればOK
- エラーが出た場合は、[トラブルシューティング](#11-トラブルシューティング)を参照

### ステップ 7-4: テーブルが作成されたか確認

1. 左メニューから「**Table Editor**」をクリック
2. 以下のテーブルが表示されていればOK：
   - ✅ categories
   - ✅ products
   - ✅ sales
   - ✅ sale_items
   - ✅ product_collections
   - ✅ collection_products

### ステップ 7-5: サンプルデータの確認

1. 「categories」テーブルをクリック
2. 「ドリンク」「フード」「季節限定」の3件が表示されればOK

---

## 8. 環境変数の設定

### ステップ 8-1: Supabase認証情報を取得

1. Supabaseダッシュボードの左下にある「**⚙️ Project Settings**」をクリック
2. 左メニューから「**API**」をクリック

### ステップ 8-2: 必要な情報をコピー

以下の3つをメモ帳などにコピーしておきます：

1. **Project URL**
   - 「Project URL」と書かれた欄の値
   - 例：`https://abcdefghijklmn.supabase.co`

2. **anon public key**
   - 「Project API keys」セクションの「anon」「public」と書かれた欄
   - 「👁️ Reveal」をクリックして表示
   - 例：`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`（長い文字列）

3. **service_role key**（秘密鍵）
   - 「Project API keys」セクションの「service_role」「secret」と書かれた欄
   - 「👁️ Reveal」をクリックして表示
   - 例：`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`（長い文字列）

### ステップ 8-3: 環境変数ファイルを作成

1. プロジェクトフォルダ内の `.env.example` ファイルを開く
2. 同じフォルダに `.env.local` という名前で**新規ファイルを作成**

**Windowsの場合：**
- メモ帳で開いて「名前を付けて保存」
- ファイル名：`.env.local`
- ファイルの種類：「すべてのファイル」を選択

**Macの場合：**
- テキストエディットで開いて保存
- またはターミナルで：`cp .env.example .env.local`

### ステップ 8-4: 認証情報を貼り付け

`.env.local` ファイルに以下の内容を記述します：

```bash
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=先ほどコピーしたProject URL
NEXT_PUBLIC_SUPABASE_ANON_KEY=先ほどコピーしたanon public key
SUPABASE_SERVICE_ROLE_KEY=先ほどコピーしたservice_role key
```

**記入例：**
```bash
NEXT_PUBLIC_SUPABASE_URL=https://abcdefghijklmn.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFiY2RlZmdoaWprbG1uIiwicm9sZSI6ImFub24iLCJpYXQiOjE2MjA...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFiY2RlZmdoaWprbG1uIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTYyMD...
```

**🔴 重要な注意点：**
- `=` の前後にスペースを入れない
- 値を `"` で囲まない
- 3つすべて記入する

### ステップ 8-5: ファイルを保存

保存後、ファイルを閉じます。

---

## 9. アプリケーションの起動

### ステップ 9-1: 開発サーバーを起動

コマンドプロンプト/ターミナルで、プロジェクトフォルダにいることを確認し、以下を実行：

```bash
npm run dev
```

**起動中の表示例：**
```
   ▲ Next.js 14.2.18
   - Local:        http://localhost:3000
   - Environments: .env.local

 ✓ Starting...
 ✓ Ready in 2.3s
```

**🔴 注意：このウィンドウは開いたままにしておく**

### ステップ 9-2: ブラウザでアクセス

1. ブラウザ（Chrome、Edge、Safariなど）を開く
2. アドレスバーに `http://localhost:3000` と入力
3. Enterキーを押す

---

## 10. 動作確認

### ステップ 10-1: トップページの確認

以下が表示されていればOK：
- ☕ 学生経営カフェ管理システム（タイトル）
- メニュー管理、売上入力のカード
- Powered by Supabase 🚀

### ステップ 10-2: メニュー管理画面の確認

1. 「メニュー管理」カードをクリック
2. カテゴリ一覧に以下が表示されているか確認：
   - ドリンク
   - フード
   - 季節限定
3. 商品一覧に商品が表示されているか確認

### ステップ 10-3: 新規カテゴリ追加のテスト

1. 「新規カテゴリ追加」フォームに入力：
   - カテゴリ名：`デザート`
   - 説明：`ケーキ、アイスなど`
   - 表示順：`4`
2. 「カテゴリを追加」ボタンをクリック
3. 「カテゴリを追加しました」と表示されればOK
4. カテゴリ一覧に「デザート」が追加されているか確認

### ステップ 10-4: 新規商品追加のテスト

1. 「新規商品追加」フォームに入力：
   - カテゴリ：`デザート`（先ほど追加したもの）
   - 商品名：`チョコレートケーキ`
   - 販売価格：`550`
   - 原価：`250`
2. 「商品を追加」ボタンをクリック
3. 「商品を追加しました」と表示されればOK
4. 商品一覧に「チョコレートケーキ」が追加されているか確認

### ステップ 10-5: 売上入力画面の確認

1. 左上の「← ホームに戻る」をクリック
2. 「売上入力」カードをクリック
3. 商品一覧が表示されているか確認
4. 適当な商品をクリックして「今回の会計」に追加
5. 「会計を登録」ボタンをクリック
6. 「会計を登録しました（売上ID: 1）」と表示されればOK

### ステップ 10-6: Supabaseでデータを確認

1. Supabaseダッシュボードを開く
2. 「Table Editor」→「sales」テーブルを開く
3. 今登録した売上データが表示されていればOK ✅

---

## 11. トラブルシューティング

### 問題1: `npm install` でエラーが出る

**原因：** Node.jsのバージョンが古い

**解決策：**
1. Node.jsをアンインストール
2. [https://nodejs.org/](https://nodejs.org/) から最新のLTS版をダウンロード
3. インストール後、`npm install` を再実行

---

### 問題2: SQL実行時にエラーが出る

**原因：** SQLスクリプトが正しくコピーできていない

**解決策：**
1. `supabase-schema.sql` ファイルを再度開く
2. 内容を**すべて選択**してコピー
3. SQL Editorに貼り付け直して再実行

---

### 問題3: 「Supabase環境変数が設定されていません」エラー

**原因：** `.env.local` ファイルが正しく作成されていない

**解決策：**
1. プロジェクトフォルダに `.env.local` ファイルがあるか確認
2. ファイル名が正確に `.env.local` であることを確認（`.txt` などがついていないか）
3. ファイル内容が正しいか確認（[ステップ8-4](#ステップ-8-4-認証情報を貼り付け)を参照）
4. 開発サーバーを再起動（Ctrl+C で停止 → `npm run dev` で再起動）

---

### 問題4: 「カテゴリの取得に失敗しました」エラー

**原因：** Supabase認証情報が間違っている

**解決策：**
1. Supabaseダッシュボード → Project Settings → API を開く
2. Project URLとAPIキーを再確認
3. `.env.local` の内容と一致しているか確認
4. 開発サーバーを再起動

---

### 問題5: ブラウザで「このサイトにアクセスできません」

**原因：** 開発サーバーが起動していない

**解決策：**
1. コマンドプロンプト/ターミナルで `npm run dev` が実行されているか確認
2. エラーメッセージが出ていないか確認
3. 別のプログラムがポート3000を使用していないか確認
   - その場合は、ポート番号を変更：`npm run dev -- -p 3001`

---

### 問題6: データが保存されない

**原因：** Row Level Security (RLS) の設定ミス

**解決策：**
1. Supabaseダッシュボード → SQL Editor を開く
2. 以下のSQLを実行：
```sql
-- すべてのテーブルのRLSポリシーを確認
SELECT tablename, policyname FROM pg_policies;
```
3. "Enable all for service role" ポリシーが各テーブルにあるか確認
4. ない場合は、`supabase-schema.sql` を再実行

---

## 12. よくある質問

### Q1: Supabaseの無料プランはいつまで使える？

**A:** 無料プランには以下の制限があります：
- データベース容量：500MB
- ストレージ：1GB
- 月間リクエスト：500万回

学生カフェの規模なら、数ヶ月〜1年程度は十分使えます。

### Q2: データはどこに保存される？

**A:** Supabaseのクラウドサーバー（選択したリージョン）に保存されます。
インターネット接続があれば、どこからでもアクセス可能です。

### Q3: パソコンを再起動したら使えなくなった

**A:** 以下の手順で再開できます：
1. コマンドプロンプト/ターミナルを開く
2. プロジェクトフォルダに移動（`cd` コマンド）
3. `npm run dev` を実行
4. ブラウザで `http://localhost:3000` にアクセス

### Q4: 他のパソコンでも使いたい

**A:** プロジェクトフォルダと `.env.local` ファイルをコピーすれば、他のPCでも使えます。
ただし、Node.jsのインストールは必要です。

### Q5: 本番環境にデプロイしたい

**A:** Vercelへのデプロイが簡単です：
1. [https://vercel.com](https://vercel.com) でアカウント作成
2. GitHubにプロジェクトをpush
3. Vercelで「Import Project」
4. 環境変数を設定
5. デプロイ完了

---

## 13. サポート

それでも解決しない場合は、以下の情報を添えて質問してください：

- ❓ 何をしようとしていたか
- ❓ どのステップで問題が起きたか
- ❓ エラーメッセージの全文（スクリーンショット推奨）
- ❓ 使用しているOS（Windows / Mac / Linux）
- ❓ Node.jsのバージョン（`node --version` の結果）

---

## 🎉 セットアップ完了！

これで学生経営カフェ管理システムが使えるようになりました。

次のステップ：
- [ ] 実際のメニューを登録してみる
- [ ] 売上データを入力してみる
- [ ] Supabaseのダッシュボードでデータを確認してみる
- [ ] 認証機能を追加する（応用編）
- [ ] 本番環境へデプロイする（応用編）

頑張ってください！☕✨
